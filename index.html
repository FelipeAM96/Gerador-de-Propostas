<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Proposta Comercial</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 1400px; /* Aumentado para acomodar duas colunas */
        }
        input[type="text"], input[type="date"], input[type="number"], select, textarea {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-200;
        }
        button {
            @apply px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition duration-200;
        }
        .section-title {
            @apply text-xl font-semibold text-gray-800 mb-4;
        }
        .image-preview {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 10px;
        }
        .output-area {
            @apply bg-white p-6 rounded-lg shadow-lg border border-gray-200 overflow-auto;
            min-height: 500px; /* Aumentado para melhor visualização na coluna direita */
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-wrap: break-word; /* Break long words */
            line-height: 1.2; /* Ajustado para maior compactação */
            font-size: 0.9em; /* Reduzido levemente para caber mais conteúdo */
        }
        .paste-zone {
            @apply flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 cursor-pointer;
            transition: border-color 0.2s ease-in-out;
        }
        .paste-zone.has-image {
            @apply border-green-500 text-green-700;
        }
        .paste-zone:hover {
            @apply border-blue-500;
        }

        /* Estilos para o modal customizado */
        .modal {
            transition: opacity 0.3s ease-in-out;
        }

        /* Estilos para o Acordeon (mantidos, mas as classes 'accordion-item' e 'accordion-content' foram removidas dos elementos HTML) */
        .accordion-item {
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .accordion-header {
            background-color: #f3f4f6; /* bg-gray-50 */
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
        }
        .accordion-header:hover {
            background-color: #e5e7eb; /* hover:bg-gray-200 */
        }
        .accordion-content {
            padding: 1rem;
            border-top: none;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        .accordion-item.active .accordion-icon {
            transform: rotate(45deg);
        }
        /* Opcional: Estilo para campos obrigatórios */
        .required-label::after {
            content: '*';
            color: red;
            margin-left: 4px;
        }

        /* Estilos para o layout de duas colunas */
        @media (min-width: 1024px) { /* Aplica a partir de telas grandes (lg) */
            .main-content-grid {
                display: grid;
                grid-template-columns: 1fr 1fr; /* Duas colunas de largura igual */
                gap: 2rem; /* Espaçamento entre as colunas */
            }
            .left-column, .right-column {
                padding: 0; /* Remove padding extra das colunas */
            }
        }

        /* Estilos específicos para a pré-visualização */
        #previewOutput h1 {
            font-size: 1.5em !important; /* Ajuste para caber melhor na coluna */
            margin-bottom: 10px !important;
        }
        #previewOutput h3, #previewOutput h4 {
            font-size: 1em !important;
            margin: 8px 0 4px 0 !important;
        }
        #previewOutput p, #previewOutput ul, #previewOutput li {
            font-size: 0.85em !important; /* Fonte menor para mais compactação */
            line-height: 1.1 !important; /* Linha mais apertada */
            margin-bottom: 1px !important; /* Margem mínima entre parágrafos/itens */
        }
        #previewOutput ul {
            padding-left: 15px !important;
        }
        #previewOutput strong {
            font-weight: bold !important;
        }
        #previewOutput img {
            max-width: 95% !important; /* Ajusta a largura da imagem na pré-visualização */
            height: auto !important;
            margin-top: 5px !important;
            margin-bottom: 5px !important;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 lg:p-10 flex justify-center items-start min-h-screen">
    <div class="container bg-white p-6 sm:p-8 md:p-10 rounded-xl shadow-2xl space-y-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-900 mb-8">Gerador de Proposta Comercial de Imagens de Satélite</h1>

        <div class="main-content-grid">
            <!-- Coluna da Esquerda: Dados da Proposta e Adicionar Imagens (sem acordeon) -->
            <div class="left-column space-y-8 p-4 border border-gray-200 rounded-lg bg-white">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">1. Dados da Proposta</h2>
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="dataProposta" class="block text-gray-700 text-sm font-medium mb-2 required-label">Data da Proposta:</label>
                            <input type="date" id="dataProposta" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="empresaCliente" class="block text-gray-700 text-sm font-medium mb-2 required-label">Empresa Cliente:</label>
                            <input type="text" id="empresaCliente" placeholder="Nome da Empresa" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="contatoCliente" class="block text-gray-700 text-sm font-medium mb-2 required-label">Contato Cliente:</label>
                            <input type="text" id="contatoCliente" placeholder="Nome do Contato" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="cpfCliente" class="block text-gray-700 text-sm font-medium mb-2">CPF/CNPJ Cliente:</label>
                            <input type="text" id="cpfCliente" placeholder="CPF ou CNPJ do Cliente" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label for="enderecoCliente" class="block text-gray-700 text-sm font-medium mb-2">Endereço Cliente:</label>
                        <input type="text" id="enderecoCliente" placeholder="Endereço completo do Cliente" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="processoVinculado" class="block text-gray-700 text-sm font-medium mb-2">Processo Vinculado:</label>
                            <input type="text" id="processoVinculado" placeholder="Número do processo vinculado" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="extensaoArea" class="block text-gray-700 text-sm font-medium mb-2 required-label">Extensão da Área (km²):</label>
                            <input type="number" id="extensaoArea" placeholder="Ex: 100" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="dataImageamentoInicio" class="block text-gray-700 text-sm font-medium mb-2 required-label">Data de Imageamento Início:</label>
                            <input type="date" id="dataImageamentoInicio" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="dataImageamentoFim" class="block text-gray-700 text-sm font-medium mb-2 required-label">Data de Imageamento Fim:</label>
                            <input type="date" id="dataImageamentoFim" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>

                    <!-- Seção "Adicionar Imagens" movida para cá -->
                    <h2 class="text-xl font-semibold text-gray-800 mt-8 mb-4">2. Adicionar Imagens</h2>
                    <div class="space-y-6">
                        <p class="text-sm text-gray-600 mb-4">Cole suas imagens (Ctrl+V) nas áreas indicadas. Elas serão redimensionadas automaticamente para se ajustarem ao documento, mantendo a proporção. A pré-visualização da imagem só estará visível na proposta final.</p>
                        <div id="imageInputs" class="space-y-4">
                            <!-- Imagem 1: Área de Interesse (Initial image block) -->
                            <div class="p-4 border border-gray-200 rounded-lg bg-gray-50">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Área para Colar Imagem <span class="image-number">1</span> (Área de Interesse):</label>
                                <div id="pasteZone1" class="paste-zone" tabindex="0">
                                    <p class="text-center text-lg font-bold text-gray-500">Clique ou cole sua imagem aqui (Ctrl+V)</p>
                                    <p class="text-center text-sm text-gray-400 mt-1">A imagem aparecerá na pré-visualização final.</p>
                                </div>
                                <input type="hidden" id="hiddenImageData1" data-image-pasted="false">
                                <div class="mt-4 space-y-3">
                                    <div>
                                        <label for="imageCaption1" class="block text-gray-700 text-sm font-medium mb-1">Legenda da Imagem <span class="image-number">1</span>:</label>
                                        <input type="text" id="imageCaption1" value="Figura 1 - Área de interesse com informação de metragem." placeholder="Legenda descritiva para a imagem">
                                    </div>
                                    <!-- Campos de Satélite, Data e Resolução removidos para Imagem 1 -->
                                </div>
                                <!-- A tag img está presente, mas sempre oculta no formulário -->
                                <img id="imagePreview1" class="image-preview hidden" alt="Pré-visualização da Imagem 1">
                                <button type="button" class="clear-image-btn mt-4 px-4 py-2 bg-red-500 text-white text-sm rounded-md hover:bg-red-600" data-target-id="1">Limpar Imagem <span class="image-number">1</span></button>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4 mt-4">
                            <button id="addOneImageBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg py-3 sm:w-1/2">Adicionar outra imagem</button>
                            <button id="addMultipleImagesBtn" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg py-3 sm:w-1/2">Adicionar mais 5 imagens</button>
                        </div>
                    </div>
                    <!-- Fim da seção "Adicionar Imagens" movida -->

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="cenaRecomendada" class="block text-gray-700 text-sm font-medium mb-2">Cena Recomendada:</label>
                            <input type="text" id="cenaRecomendada" placeholder="Ex: Cena 12345" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="resolucaoColorida" class="block text-gray-700 text-sm font-medium mb-2">Resolução Colorida:</label>
                            <input type="text" id="resolucaoColorida" placeholder="Ex: 0.5m" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label for="dataCenaRecomendada" class="block text-gray-700 text-sm font-medium mb-2">Data(s) da Cena Recomendada (separadas por vírgula):</label>
                        <input type="text" id="dataCenaRecomendada" placeholder="Ex: 15/06/2024, 20/07/2024" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="sateliteOpcoes" class="block text-gray-700 text-sm font-medium mb-2">Satélite(s) (Opções - Ctrl+clique para múltiplos):</label>
                        <select id="sateliteOpcoes" multiple size="5" class="w-full p-3 border border-gray-300 rounded-lg">
                            <option value="ALOS AVNIR">ALOS AVNIR</option>
                            <option value="ALOS Prism">ALOS Prism</option>
                            <option value="Aster">Aster</option>
                            <option value="AXEL GLOBE">AXEL GLOBE</option>
                            <option value="BlackSky">BlackSky</option>
                            <option value="Eros B">Eros B</option>
                            <option value="FORMOSAT 2">FORMOSAT 2</option>
                            <option value="Gaofen 2">Gaofen 2</option>
                            <option value="Geoeye">Geoeye</option>
                            <option value="GEOSAT 1">GEOSAT 1</option>
                            <option value="Ikonos">Ikonos</option>
                            <option value="Jilin-1">Jilin-1</option>
                            <option value="KazEOSat-1">KazEOSat-1</option>
                            <option value="Kompsat 2">Kompsat 2</option>
                            <option value="Kompsat 3">Kompsat 3</option>
                            <option value="Kompsat-3A">Kompsat-3A</option>
                            <option value="LANDSAT 4 E 5 TM">LANDSAT 4 E 5 TM</option>
                            <option value="LANDSAT 7 ETM +">LANDSAT 7 ETM +</option>
                            <option value="LANDSAT 8">LANDSAT 8</option>
                            <option value="PLANET">PLANET</option>
                            <option value="PLEIADES">PLEIADES</option>
                            <option value="PLEIADES NEO">PLEIADES NEO</option>
                            <option value="Quick Bird">Quick Bird</option>
                            <option value="RapidEye">RapidEye</option>
                            <option value="Sentinel-2">Sentinel-2</option>
                            <option value="SKYSAT">SKYSAT</option>
                            <option value="SPOT 6/7">SPOT 6/7</option>
                            <option value="SPOT 1-2-3-4-5">SPOT 1-2-3-4-5</option>
                            <option value="SUPERVIEW">SUPERVIEW</option>
                            <option value="TerraSAR-X">TerraSAR-X</option>
                            <option value="TH-01">TH-01</option>
                            <option value="Triplesat">Triplesat</option>
                            <option value="UK DMC-2">UK DMC-2</option>
                            <option value="Vision-1">Vision-1</option>
                            <option value="World View 1">World View 1</option>
                            <option value="World View 2">World View 2</option>
                            <option value="World View 3">World View 3</option>
                            <option value="World View 4">World View 4</option>
                            <option value="ALTIMETRIA WORLDDEM">ALTIMETRIA WORLDDEM</option>
                            <option value="Altimetria WorldDEM NEO™">Altimetria WorldDEM NEO™</option>
                            <option value="Altimetria AW3D">Altimetria AW3D</option>
                        </select>
                    </div>
                    <div id="sateliteLinkOutput" class="text-blue-600 text-sm mt-2" style="display: none;"></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="pedidoMinimoKm2" class="block text-gray-700 text-sm font-medium mb-2 required-label">Pedido Mínimo (Km²):</label>
                            <input type="number" id="pedidoMinimoKm2" placeholder="Ex: 50" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="custoRs" class="block text-gray-700 text-sm font-medium mb-2 required-label">Custo (R$):</label>
                            <input type="number" id="custoRs" placeholder="Ex: 15000" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label for="diasEntrega" class="block text-gray-700 text-sm font-medium mb-2 required-label">Entrega (dias):</label>
                        <input type="number" id="diasEntrega" placeholder="Ex: 7" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                </div>

                <!-- Botão Gerar Pré-visualização na coluna esquerda -->
                <button id="generatePreviewBtn" class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition duration-200;">Gerar Pré-visualização</button>
            </div>

            <!-- Coluna da Direita: Pré-visualização e Download -->
            <div class="right-column space-y-8 p-4 border border-gray-200 rounded-lg bg-white">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">3. Pré-visualização e Download</h2>
                <div class="space-y-6">
                    <div id="previewOutput" class="output-area">
                        <p class="text-gray-500">A pré-visualização da sua proposta aparecerá aqui.</p>
                    </div>
                    <div class="mt-4">
                        <label for="docxFilename" class="block text-gray-700 text-sm font-medium mb-2">Nome do arquivo DOCX:</label>
                        <input type="text" id="docxFilename" value="Proposta Comercial de Imagens de Satélite" class="w-full p-3 border border-gray-300 rounded-lg mb-4">
                    </div>
                    <div class="flex flex-col sm:flex-row gap-4 mt-4">
                        <button id="downloadDocxBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg py-3">Baixar como .DOCX</button>
                    </div>
                </div>
            </div>
        </div>

        <p class="text-center text-sm text-gray-600 mt-8">
            <strong>Nota:</strong> Este gerador cria conteúdo em HTML. Para obter um arquivo .docx com formatação mais consistente, clique em "Baixar como .DOCX". As imagens coladas serão incorporadas diretamente no HTML.
            <br/><br/>
            **Atenção:** As quebras de página são sugestões e podem variar dependendo do editor de texto e das configurações de impressão.
        </p>
    </div>

    <!-- Custom Alert Modal -->
    <div id="customAlertModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden modal">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="customAlertMessage" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <button id="customAlertCloseBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">OK</button>
        </div>
    </div>

    <!-- Exportar HTML como .docx -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.0/dist/html-docx.min.js"></script>

    <script>
        window.onload = () => {
            // Variável para controlar o número de imagens
            let currentImageCount = 1;
            const MAX_IMAGES = 15;
            const TARGET_IMAGE_WIDTH_PX = 800; // Largura alvo em pixels para imagens redimensionadas (aproximadamente 19cm a 96 DPI)

            // Função para exibir o modal customizado
            function showCustomAlert(message) {
                document.getElementById('customAlertMessage').textContent = message;
                document.getElementById('customAlertModal').classList.remove('hidden');
            }

            // Event listener para fechar o modal
            document.getElementById('customAlertCloseBtn').addEventListener('click', () => {
                document.getElementById('customAlertModal').classList.add('hidden');
            });

            // Objeto para mapear opções de satélite para URLs
            const satelliteLinks = {
                "ALOS AVNIR": "https://www.engesat.com.br/imagem-de-satelite/alos-1/",
                "ALOS Prism": "https://www.engesat.com.br/imagem-de-satelite/alos-prism/",
                "Aster": "https://www.engesat.com.br/imagem-de-satelite/aster/",
                "AXEL GLOBE": "https://www.engesat.com.br/imagem-de-satelite/axel-globe/",
                "BlackSky": "https://www.engesat.com.br/imagem-de-satelite/blacksky/",
                "Eros B": "https://www.engesat.com.br/imagem-de-satelite/eros-b/",
                "FORMOSAT 2": "https://www.engesat.com.br/imagem-de-satelite/formosat-2/",
                "Gaofen 2": "https://www.engesat.com.br/imagem-de-satelite/gaofen-2/",
                "Geoeye": "https://www.engesat.com.br/imagem-de-satelite/geoeye/",
                "GEOSAT 1": "https://www.engesat.com.br/imagem-de-satelite/geosat1/",
                "Ikonos": "https://www.engesat.com.br/imagem-de-satelite/ikonos/",
                "Jilin-1": "https://www.engesat.com.br/imagem-de-satelite/jilin-1/",
                "KazEOSat-1": "https://www.engesat.com.br/imagem-de-satelite/kazeosat-1/",
                "Kompsat 2": "https://www.engesat.com.br/imagem-de-satelite/kompsat-2/",
                "Kompsat 3": "https://www.engesat.com.br/imagem-de-satelite/kompsat-3/",
                "Kompsat-3A": "https://www.engesat.com.br/imagem-de-satelite/kompsat-3a/",
                "LANDSAT 4 E 5 TM": "https://www.engesat.com.br/imagem-de-satelite/landsat/",
                "LANDSAT 7 ETM +": "https://www.engesat.com.br/imagem-de-satelite/landsat-7-etm/",
                "LANDSAT 8": "https://www.engesat.com.br/imagem-de-satelite/landsat-8/",
                "PLANET": "https://www.engesat.com.br/imagem-de-satelite/planetscope/",
                "PLEIADES": "https://www.engesat.com.br/imagem-de-satelite/pleiades/",
                "PLEIADES NEO": "https://www.engesat.com.br/imagem-de-satelite/pleiades-neo/",
                "Quick Bird": "https://www.engesat.com.br/imagem-de-satelite/quick-bird/",
                "RapidEye": "https://www.engesat.com.br/imagem-de-satelite/rapideye/",
                "Sentinel-2": "https://www.engesat.com.br/sentinel-2/",
                "SKYSAT": "https://www.engesat.com.br/imagem-de-satelite/skysat/",
                "SPOT 6/7": "https://www.engesat.com.br/imagem-de-satelite/spot-67/",
                "SPOT 1-2-3-4-5": "https://www.engesat.com.br/imagem-de-satelite/spot-1-2-3-4-5/",
                "SUPERVIEW": "https://www.engesat.com.br/imagem-de-satelite/superview/",
                "TerraSAR-X": "https://www.engesat.com.br/imagem-de-satelite/terrasar-x/",
                "TH-01": "https://www.engesat.com.br/imagem-de-satelite/th-01/",
                "Triplesat": "https://www.engesat.com.br/imagem-de-satelite/triplesat/",
                "UK DMC-2": "https://www.engesat.com.br/imagem-de-satelite/uk-dmc-2/",
                "Vision-1": "https://www.engesat.com.br/vision-1/",
                "World View 1": "https://www.engesat.com.br/imagem-de-satelite/world-view-1/",
                "World View 2": "https://www.engesat.com.br/imagem-de-satelite/world-view-2/",
                "World View 3": "https://www.engesat.com.br/imagem-de-satelite/world-view-3/",
                "World View 4": "https://www.engesat.com.br/imagem-de-satelite/world-view-4/",
                "ALTIMETRIA WORLDDEM": "https://www.engesat.com.br/mercados/altimetria/",
                "Altimetria WorldDEM NEO™": "https://www.engesat.com.br/mercados/altimetria-worlddem-neo/",
                "Altimetria AW3D": "https://www.engesat.com.br/mercados/altimetria-aw3d/"
            };

            // Event listener para o select de satélites
            document.getElementById('sateliteOpcoes').addEventListener('change', () => {
                const selectedSatellites = Array.from(document.getElementById('sateliteOpcoes').selectedOptions).map(option => option.value);
                const linkOutput = document.getElementById('sateliteLinkOutput');
                let linksHtml = '';
                if (selectedSatellites.length > 0) {
                    linksHtml += 'Links dos Satélites Selecionados:<br>';
                    selectedSatellites.forEach(sat => {
                        const link = satelliteLinks[sat];
                        if (link) {
                            linksHtml += `<a href="${link}" target="_blank" style="color: #2563eb; text-decoration: underline;">${sat}: ${link}</a><br>`;
                        }
                    });
                    linkOutput.innerHTML = linksHtml;
                    linkOutput.style.display = 'block';
                } else {
                    linkOutput.innerHTML = '';
                    linkOutput.style.display = 'none';
                }
            });

            // Função para redimensionar a imagem usando Canvas
            function resizeImage(imageDataUrl, maxWidthPx) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        let width = img.width;
                        let height = img.height;

                        if (width > maxWidthPx) {
                            height = height * (maxWidthPx / width);
                            width = maxWidthPx;
                        }

                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        resolve(canvas.toDataURL('image/png')); // Convert to PNG for better quality
                    };
                    img.src = imageDataUrl;
                });
            }

            // Função para lidar com a colagem de imagens
            async function handleImagePaste(event, pasteZoneId, hiddenInputId, previewImgId) {
                event.preventDefault();

                const items = (event.clipboardData || event.originalEvent.clipboardData).items;
                let imageFound = false;

                for (const item of items) {
                    if (item.kind === 'file' && item.type.startsWith('image/')) {
                        const file = item.getAsFile();
                        const reader = new FileReader();

                        reader.onload = async (e) => {
                            const originalImageDataUrl = e.target.result;
                            // Redimensionar a imagem antes de armazenar e pré-visualizar
                            const resizedImageDataUrl = await resizeImage(originalImageDataUrl, TARGET_IMAGE_WIDTH_PX);

                            const pasteZone = document.getElementById(pasteZoneId);
                            const hiddenInput = document.getElementById(hiddenInputId);
                            const previewImg = document.getElementById(previewImgId);

                            hiddenInput.value = resizedImageDataUrl;
                            hiddenInput.setAttribute('data-image-pasted', 'true');

                            // A imagem não será exibida no formulário, apenas o texto de confirmação
                            previewImg.classList.add('hidden'); // Garante que a pré-visualização no formulário permaneça oculta

                            pasteZone.innerHTML = '<p class="text-center text-lg font-bold text-green-700">Imagem colada com sucesso!</p><p class="text-center text-sm text-green-600 mt-1">A imagem aparecerá na pré-visualização final.</p>';
                            pasteZone.classList.add('has-image');
                        };
                        reader.readAsDataURL(file);
                        imageFound = true;
                        break;
                    }
                }

                if (!imageFound) {
                    const pasteZone = document.getElementById(pasteZoneId);
                    const pastedText = (event.clipboardData || window.clipboardData).getData('text');
                    if (pastedText) {
                        pasteZone.innerHTML = `<p class="text-center text-lg font-bold text-gray-500">Texto colado (não é uma imagem):</p><p class="text-center text-sm text-gray-400 mt-1">${pastedText.substring(0, 50)}${pastedText.length > 50 ? '...' : ''}</p>`;
                        pasteZone.classList.remove('has-image');
                        const hiddenInput = document.getElementById(hiddenInputId);
                        hiddenInput.value = '';
                        hiddenInput.setAttribute('data-image-pasted', 'false');
                        document.getElementById(previewImgId).classList.add('hidden');
                    } else {
                        pasteZone.innerHTML = '<p class="text-center text-lg font-bold text-gray-500">Nenhuma imagem ou texto válido colado.</p><p class="text-center text-sm text-gray-400 mt-1">Tente novamente.</p>';
                        pasteZone.classList.remove('has-image');
                    }
                }
            }

            // Função para limpar a imagem colada
            function clearImage(id) {
                const pasteZone = document.getElementById(`pasteZone${id}`);
                const hiddenInput = document.getElementById(`hiddenImageData${id}`);
                const previewImg = document.getElementById(`imagePreview${id}`);
                const imageCaption = document.getElementById(`imageCaption${id}`);
                // Campos de satélite, data e resolução só existem para id > 1
                const imageSat = document.getElementById(`image${id}Sat`);
                const imageDate = document.getElementById(`image${id}Date`);
                const imageRes = document.getElementById(`image${id}Res`);


                pasteZone.innerHTML = '<p class="text-center text-lg font-bold text-gray-500">Clique ou cole sua imagem aqui (Ctrl+V)</p><p class="text-center text-sm text-gray-400 mt-1">A imagem aparecerá na pré-visualização final.</p>';
                pasteZone.classList.remove('has-image');
                hiddenInput.value = '';
                hiddenInput.setAttribute('data-image-pasted', 'false');
                previewImg.src = '';
                previewImg.classList.add('hidden'); // Garante que a pré-visualização no formulário permaneça oculta

                if (id === 1) {
                    imageCaption.value = "Figura 1 - Área de interesse com informação de metragem.";
                } else {
                    imageCaption.value = `Figura ${id} – Imagem de satélite Quick Look em catálogo.`;
                }

                // Limpa os campos apenas se existirem (para id > 1)
                if (imageSat) imageSat.value = '';
                if (imageDate) imageDate.value = '';
                if (imageRes) imageRes.value = '';
            }

            // Função para adicionar um novo bloco de imagem
            function addImageInput(numToAdd = 1) {
                const imageInputsContainer = document.getElementById('imageInputs');
                for (let k = 0; k < numToAdd; k++) {
                    if (currentImageCount >= MAX_IMAGES) {
                        showCustomAlert(`Limite máximo de ${MAX_IMAGES} imagens atingido.`);
                        return;
                    }
                    currentImageCount++;
                    const newImageBlock = document.createElement('div');
                    newImageBlock.className = 'p-4 border border-gray-200 rounded-lg bg-gray-50';
                    newImageBlock.innerHTML = `
                        <label class="block text-gray-700 text-sm font-medium mb-2">Área para Colar Imagem <span class="image-number">${currentImageCount}</span>:</label>
                        <div id="pasteZone${currentImageCount}" class="paste-zone" tabindex="0">
                            <p class="text-center text-lg font-bold text-gray-500">Clique ou cole sua imagem aqui (Ctrl+V)</p>
                            <p class="text-center text-sm text-gray-400 mt-1">A imagem aparecerá na pré-visualização final.</p>
                        </div>
                        <input type="hidden" id="hiddenImageData${currentImageCount}" data-image-pasted="false">
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="imageCaption${currentImageCount}" class="block text-gray-700 text-sm font-medium mb-1">Legenda da Imagem <span class="image-number">${currentImageCount}</span>:</label>
                                <input type="text" id="imageCaption${currentImageCount}" value="Figura ${currentImageCount} – Imagem de satélite Quick Look em catálogo." placeholder="Legenda descritiva para a imagem">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div>
                                    <label for="image${currentImageCount}Sat" class="block text-gray-700 text-sm font-medium mb-1">Satélite:</label>
                                    <input type="text" id="image${currentImageCount}Sat" placeholder="Ex: WorldView 3">
                                </div>
                                <div>
                                    <label for="image${currentImageCount}Date" class="block text-gray-700 text-sm font-medium mb-1">Data:</label>
                                    <input type="text" id="image${currentImageCount}Date" placeholder="Ex: 01/01/2024">
                                </div>
                                <div>
                                    <label for="image${currentImageCount}Res" class="block text-gray-700 text-sm font-medium mb-1">Resolução:</label>
                                    <input type="text" id="image${currentImageCount}Res" placeholder="Ex: 0.5m">
                                </div>
                            </div>
                        </div>
                        <!-- A tag img está presente, mas sempre oculta no formulário -->
                        <img id="imagePreview${currentImageCount}" class="image-preview hidden" alt="Pré-visualização da Imagem ${currentImageCount}">
                        <button type="button" class="clear-image-btn mt-4 px-4 py-2 bg-red-500 text-white text-sm rounded-md hover:bg-red-600" data-target-id="${currentImageCount}">Limpar Imagem <span class="image-number">${currentImageCount}</span></button>
                    `;
                    imageInputsContainer.appendChild(newImageBlock);

                    // Add event listeners to the newly created elements
                    document.getElementById(`pasteZone${currentImageCount}`).addEventListener('paste', (e) => handleImagePaste(e, `pasteZone${currentImageCount}`, `hiddenImageData${currentImageCount}`, `imagePreview${currentImageCount}`));
                    document.querySelector(`.clear-image-btn[data-target-id="${currentImageCount}"]`).addEventListener('click', (e) => {
                        const targetId = e.target.dataset.targetId;
                        clearImage(targetId);
                    });
                }
            }

            // Add event listeners for the new buttons
            document.getElementById('addOneImageBtn').addEventListener('click', () => addImageInput(1));
            document.getElementById('addMultipleImagesBtn').addEventListener('click', () => addImageInput(5));


            // Add listeners for the initial image block
            document.getElementById(`pasteZone1`).addEventListener('paste', (e) => handleImagePaste(e, `pasteZone1`, `hiddenImageData1`, `imagePreview1`));
            document.querySelector(`.clear-image-btn[data-target-id="1"]`).addEventListener('click', (e) => {
                const targetId = e.target.dataset.targetId;
                clearImage(targetId);
            });


            // Função para formatar a data de ISO (YYYY-MM-DD) para DD/MM/YYYY ou manter DD/MM/YYYY
            function formatarData(dateString) {
                if (!dateString) return '';
                dateString = dateString.trim();
                // Check if it's already in DD/MM/YYYY format
                if (dateString.match(/^\d{2}\/\d{2}\/\d{4}$/)) {
                    return dateString;
                }
                // Assume ISO (YYYY-MM-DD) for conversion
                const [year, month, day] = dateString.split('-');
                if (year && month && day) {
                    return `${day}/${month}/${year}`;
                }
                return ''; // Return empty if format is unrecognized
            }

            document.getElementById('generatePreviewBtn').addEventListener('click', () => {
                const dataProposta = formatarData(document.getElementById('dataProposta').value);
                const empresaCliente = document.getElementById('empresaCliente').value;
                const contatoCliente = document.getElementById('contatoCliente').value;
                const cpfCliente = document.getElementById('cpfCliente').value;
                const enderecoCliente = document.getElementById('enderecoCliente').value;
                const processoVinculado = document.getElementById('processoVinculado').value;
                const extensaoArea = document.getElementById('extensaoArea').value;
                const dataImageamentoInicio = formatarData(document.getElementById('dataImageamentoInicio').value);
                const dataImageamentoFim = formatarData(document.getElementById('dataImageamentoFim').value);
                const cenaRecomendada = document.getElementById('cenaRecomendada').value;
                const resolucaoColorida = document.getElementById('resolucaoColorida').value;

                // Processa múltiplas datas da cena recomendada
                const dataCenaRecomendadaInput = document.getElementById('dataCenaRecomendada').value;
                const formattedCenaDates = dataCenaRecomendadaInput.split(',').map(dateStr => formatarData(dateStr.trim())).filter(Boolean).join(', ');

                // Processa múltiplos satélites e constrói a seção de amostras
                const selectedSatellites = Array.from(document.getElementById('sateliteOpcoes').selectedOptions).map(option => option.value);
                let samplesHtml = '';
                if (selectedSatellites.length > 0) {
                    samplesHtml += `
                        <h4 style="margin: 10px 0 5px 0; font-size: 1em; font-weight: 500; color: #374151;">Informações e Amostras de Imagens de Satélite:</h4>
                        <ul style="list-style-type: disc; margin: 0; padding-left: 15px; line-height: 1.2;">
                    `;
                    selectedSatellites.forEach(sat => {
                        const link = satelliteLinks[sat];
                        if (link) {
                            samplesHtml += `<li style="margin-bottom: 2px; font-size: 0.9em;"><strong>${sat}:</strong> <a href="${link}" target="_blank" style="color: #2563eb; text-decoration: underline;">${link}</a></li>`;
                        } else {
                            samplesHtml += `<li style="margin-bottom: 2px; font-size: 0.9em;"><strong>${sat}</strong></li>`;
                        }
                    });
                    samplesHtml += `</ul>`;
                }


                const pedidoMinimoKm2 = document.getElementById('pedidoMinimoKm2').value;
                const custoRs = parseFloat(document.getElementById('custoRs').value).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) || '####';
                const diasEntrega = document.getElementById('diasEntrega').value;

                const previewOutput = document.getElementById('previewOutput');
                const downloadDocxBtn = document.getElementById('downloadDocxBtn');

                // Define as dimensões para as imagens no DOCX em cm
                const IMAGE_WIDTH_CM = 19; // Largura fixa em cm

                let imagesHtmlFigura1 = '';
                let imagesHtmlFigurasAlternativas = '';

                for (let i = 1; i <= currentImageCount; i++) {
                    const hiddenInput = document.getElementById(`hiddenImageData${i}`);
                    // Check if the element exists (for dynamically added images)
                    if (!hiddenInput) continue;

                    const imageDataUrl = hiddenInput.value;
                    const imageCaption = document.getElementById(`imageCaption${i}`).value;

                    // Novos campos de detalhes da imagem
                    const imageSat = document.getElementById(`image${i}Sat`) ? document.getElementById(`image${i}Sat`).value : '';
                    const imageDate = document.getElementById(`image${i}Date`) ? document.getElementById(`image${i}Date`).value : '';
                    const imageRes = document.getElementById(`image${i}Res`) ? document.getElementById(`image${i}Res`).value : '';

                    // Explicitly set width and auto height with !important for DOCX compatibility
                    // Adding width and height attributes directly to the img tag for better DOCX conversion
                    let imageStyle = `width: ${IMAGE_WIDTH_CM}cm !important; height: auto !important; border-radius: 8px; display: block; margin: 0 auto;`;

                    if (imageDataUrl && hiddenInput.getAttribute('data-image-pasted') === 'true') {
                        let imageBlock = `
                            <div style="margin-bottom: 10px; text-align: center; page-break-inside: avoid;">
                        `;
                        // Adiciona os novos detalhes da imagem se existirem e não for a Figura 1
                        if (i !== 1) {
                            if (imageSat) imageBlock += `<p style="font-size: 0.85em; color: #666; margin: 0;"><strong>Satélite:</strong> ${imageSat}</p>`;
                            if (imageDate) imageBlock += `<p style="font-size: 0.85em; color: #666; margin: 0;"><strong>Data:</strong> ${imageDate}</p>`;
                            if (imageRes) imageBlock += `<p style="font-size: 0.85em; color: #666; margin: 0 0 2px 0;"><strong>Resolução:</strong> ${imageRes}</p>`;
                        }
                        imageBlock += `
                                <img src="${imageDataUrl}" alt="${imageCaption || 'Imagem do Documento'}" style="${imageStyle}" width="${IMAGE_WIDTH_CM}cm">
                                ${imageCaption ? `<p style="font-size: 0.9em; text-align: center; color: #555; margin-top: 5px; font-style: italic;">${imageCaption}</p>` : ''}
                            </div>
                        `;

                        if (i === 1) {
                            imagesHtmlFigura1 = imageBlock;
                        } else {
                            imagesHtmlFigurasAlternativas += imageBlock;
                        }
                    }
                }

                // Conteúdo das Especificações Técnicas
                const especificacoesTecnicasHtml = `
                    <h4 style="margin: 10px 0 5px 0; font-size: 1em; font-weight: 500; color: #374151;">Especificações Técnicas das Imagens:</h4>
                    <ul style="list-style-type: disc; margin: 0; padding-left: 15px; line-height: 1.2;">
                        <li style="margin-bottom: 2px; font-size: 0.9em;">Ortoretificada</li>
                        <li style="margin-bottom: 2px; font-size: 0.9em;">Sistema de coordenadas UTM Sirgas 2000</li>
                        <li style="margin-bottom: 2px; font-size: 0.9em;">Formato GeoTIFF, com 3 ou 4 bandas</li>
                    </ul>
                `;

                // Conteúdo dos Detalhes do Pedido
                const detalhesPedidoHtml = `
                    <h4 style="margin: 10px 0 5px 0; font-size: 1em; font-weight: 500; color: #374151;">Detalhes do Pedido</h4>
                    <ul style="list-style-type: disc; margin: 0; padding-left: 15px; line-height: 1.2;">
                        <li style="margin-bottom: 2px; font-size: 0.9em;">Pedido mínimo de ${pedidoMinimoKm2} Km2</li>
                        <li style="margin-bottom: 2px; font-size: 0.9em;">Custo de R$ ${custoRs}</li>
                        <li style="margin-bottom: 2px; font-size: 0.9em;">Entrega em ${diasEntrega} dias</li>
                        <li style="margin-bottom: 2px; font-size: 0.9em;">Pagamento na confirmação do pedido</li>
                    </ul>
                `;

                // Logo da Engesat
                const engesatLogoUrl = "https://www.engesat.com.br/wp-content/uploads/2024/12/engesat-logomarca.png";


                const htmlContent = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h1 style="font-size: 1.8em; font-weight: bold; margin: 0;">Proposta Comercial</h1>
                        <p style="margin-top: 5px; font-size: 0.9em;">Curitiba, ${dataProposta}</p>
                    </div>

                    <div style="margin-bottom: 15px; padding: 10px; border-radius: 6px; background-color: #f9fafb; border: 1px solid #e5e7eb;">
                        <h3 style="font-size: 1.125em; font-weight: 600; color: #1f2937; margin: 0 0 8px 0;">Dados do Cliente</h3>
                        <p style="margin: 0 0 2px 0; font-size: 0.9em; line-height: 1.2;"><strong>Empresa:</strong> ${empresaCliente}</p>
                        <p style="margin: 0 0 2px 0; font-size: 0.9em; line-height: 1.2;"><strong>Contato:</strong> ${contatoCliente}</p>
                        <p style="margin: 0 0 2px 0; font-size: 0.9em; line-height: 1.2;"><strong>CPF/CNPJ:</strong> ${cpfCliente}</p>
                        <p style="margin: 0 0 2px 0; font-size: 0.9em; line-height: 1.2;"><strong>Endereço:</strong> ${enderecoCliente}</p>
                        <p style="margin: 0; font-size: 0.9em; line-height: 1.2;"><strong>Processo Vinculado:</strong> ${processoVinculado}</p>
                    </div>

                    <p style="margin: 0 0 10px 0; line-height: 1.2; font-size: 0.9em;">As ilustrações aqui apresentadas são <span style="color: red; font-weight: bold;">prévias (Quick Look)</span>, usadas para conferir a localização e eventual presença de nuvens e <span style="color: red; font-weight: bold;">não retratam a qualidade final da imagem entregue</span>.</p>
                    <p style="margin: 0 0 10px 0; line-height: 1.2; font-size: 0.9em;"><strong>Link para acesso de amostras reais dos satélites:</strong> <a href="https://www.engesat.com.br/imagem-de-satelite/" target="_blank" style="color: #2563eb; text-decoration: underline;">https://www.engesat.com.br/imagem-de-satelite/</a></p>
                    <p style="margin: 0 0 10px 0; line-height: 1.2; font-size: 0.9em;">Boa tarde,</p>
                    <p style="margin: 0 0 10px 0; line-height: 1.2; font-size: 0.9em;">Segue proposta para fornecimento de imagem de satélite,</p>

                    <div style="margin-bottom: 15px; padding: 10px; border-radius: 6px; background-color: #f9fafb; border: 1px solid #e5e7eb;">
                        <p style="margin: 0 0 5px 0; font-size: 0.9em; line-height: 1.2;"><strong>Extensão da Área:</strong> ${extensaoArea} km²</p>
                        ${imagesHtmlFigura1}
                        <!-- Sugestão de quebra de página 1 -->
                        <div style="page-break-after: always;"></div>

                        <p style="margin: 0 0 10px 0; line-height: 1.2; font-size: 0.9em;">Alternativas de Imagens Disponíveis para a Área: Para datas de imageamento entre ${dataImageamentoInicio} e ${dataImageamentoFim}, recomendamos a cena ${cenaRecomendada} de ${resolucaoColorida} de resolução colorida de ${formattedCenaDates} como segue:</p>

                        ${imagesHtmlFigurasAlternativas}

                        <p style="margin: 0 0 10px 0; line-height: 1.2; font-size: 0.9em;">As ilustrações acima são <span style="color: red; font-weight: bold;">prévias (Quick Look)</span>,
                        utilizadas apenas para verificar a localização da área e a presença de nuvens. Elas <span style="color: red; font-weight: bold;">não representam a qualidade final da imagem que será entregue</span>.</p>

                        ${samplesHtml}

                        <!-- Forçar quebra de página para as seções abaixo -->
                        <div style="page-break-before: always;"></div>

                        ${especificacoesTecnicasHtml}
                        ${detalhesPedidoHtml}

                    </div>
                    <div style="margin-bottom: 15px; padding: 10px; border-radius: 6px; background-color: #f9fafb; border: 1px solid #e5e7eb;">
                        <h3 style="font-size: 1.125em; font-weight: 600; color: #1f2937; margin: 0 0 8px 0;">Informações Administrativas e Bancárias</h3>
                        <h4 style="margin: 10px 0 5px 0; font-size: 1em; font-weight: 500; color: #374151;">📄 Dados Administrativos – Engesat Imagens de Satélite</h4>
                        <ul style="list-style-type: disc; margin: 0; padding-left: 15px; line-height: 1.2;">
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>Nome Fantasia:</strong> Engesat Imagens de Satélite</li>
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>Razão Social:</strong> EISAT Imagens de Satélite Ltda. – EPP</li>
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>CNPJ:</strong> 02.059.387/0001-87</li>
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>Inscrição Estadual:</strong> ISENTO</li>
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>Inscrição Municipal:</strong> 0701351363-2</li>
                        </ul>

                        <h4 style="margin: 10px 0 5px 0; font-size: 1em; font-weight: 500; color: #374151;">💳 Dados Bancários</h4>
                        <ul style="list-style-type: disc; margin: 0; padding-left: 15px; line-height: 1.2;">
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>Banco:</strong> Banco Inter 077</li>
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>Agência:</strong> 0001</li>
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>Conta Corrente:</strong> 43930235-8</li>
                            <li style="margin-bottom: 2px; font-size: 0.9em;"><strong>PIX (CNPJ):</strong> 02.059.387/0001-87</li>
                        </ul>
                    </div>

                    <p style="margin: 0 0 5px 0; line-height: 1.2; font-size: 0.9em;">Espero que ajude e que seja tecnicamente e comercialmente viável para o seu projeto</p>
                    <p style="margin: 0 0 10px 0; line-height: 1.2; font-size: 0.9em;">Permanecemos a sua disposição para maiores esclarecimentos.</p>
                    <p style="margin: 0 0 2px 0; line-height: 1.2; font-size: 0.9em;">Atenciosamente,</p>
                    <p style="margin: 0 0 2px 0; line-height: 1.2; font-size: 0.9em;">Laurent MARTIN,</p>
                    <p style="margin: 0; font-size: 0.9em; line-height: 1.2;">Diretor</p>
                    <div style="text-align: center; margin-top: 15px;">
                        <img src="${engesatLogoUrl}" alt="" style="width: 80px; height: auto; max-width: 80px; border-radius: 8px;">
                    </div>
                `;

                previewOutput.innerHTML = htmlContent;
                downloadDocxBtn.style.display = 'block';
            });

            document.getElementById('downloadDocxBtn').addEventListener('click', () => {
                const previewOutput = document.getElementById('previewOutput');
                if (!previewOutput || !previewOutput.innerHTML.trim()) {
                    showCustomAlert('Gere a pré-visualização antes de baixar o .docx.');
                    return;
                }

                // Get the filename from the input field
                const filename = document.getElementById('docxFilename').value.trim();
                if (!filename) {
                    showCustomAlert('Por favor, insira um nome para o arquivo DOCX.');
                    return;
                }

                // Verifica se htmlDocx está definido antes de usar
                if (typeof htmlDocx === 'undefined') {
                    console.error('Erro: html-docx-js não está carregado ou acessível.');
                    showCustomAlert('Erro ao tentar baixar o .docx. Por favor, tente novamente ou contacte o suporte.');
                    return;
                }

                const content = `
                    <html xmlns:o="urn:schemas-microsoft-com:office:office"
                          xmlns:w="urn:schemas-microsoft-com:office:word"
                          xmlns="http://www.w3.org/TR/REC-html40">\
                    <head><meta charset="utf-8"></head>
                    <body>${previewOutput.innerHTML}</body>
                    </html>
                `;

                const blob = htmlDocx.asBlob(content, {
                    orientation: 'portrait',
                    margins: { top: 720, right: 720, bottom: 720, left: 720 }
                });

                saveAs(blob, filename + '.docx');
                showCustomAlert('Arquivo .docx gerado e pronto para download!');
            });

            // O código do acordeão foi removido, pois as seções agora estão sempre visíveis.
            // As classes 'accordion-item', 'accordion-header', 'accordion-content', 'accordion-icon'
            // foram removidas do HTML das seções de entrada para desativar o comportamento.
            // A seção de pré-visualização continua com as classes para manter a aparência visual,
            // mas sem a funcionalidade de recolher/expandir.

            // Realce de campos obrigatórios (apenas visual, sem validação real aqui)
            document.querySelectorAll('label[for="dataProposta"], label[for="empresaCliente"], label[for="contatoCliente"], label[for="extensaoArea"], label[for="dataImageamentoInicio"], label[for="dataImageamentoFim"], label[for="custoRs"], label[for="diasEntrega"]').forEach(label => {
                label.classList.add('required-label');
            });
        };
    </script>
</body>
</html>
